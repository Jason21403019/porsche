---
// Astro Component
---

<div class="taycan-slider">
  <button class="nav-btn prev">&lt;</button>
  <div class="slider-container">
    <div class="slider-track">
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      <div class="slide" data-index="0">
        <div class="content-wrapper">
          <h3 class="car-name">Taycan 4</h3>

          <p class="price">NTD 5,320,000</p>
          <div class="specs">
            <p>馬力: 530hp</p>
            <p>加速: 0-100km/h 4.0秒</p>
            <p>最高時速: 220km/h</p>
          </div>
          <button class="view-more">查看更多</button>
          <div class="car-image">
            <img src="/public/img/taycan-gts.png" alt="Taycan 4" />
          </div>
        </div>
      </div>
      {/* 可以根据需要添加更多slide */}
    </div>
  </div>
  <button class="nav-btn next">&gt;</button>
</div>

<style lang="scss">
  .taycan-slider {
    position: relative;
    width: 100%;
    height: 600px;
    background: #f8f8f8;
    display: flex;
    align-items: flex-end; // 改为底部对齐
    justify-content: center;
    overflow: hidden;
    padding-bottom: 40px; // 添加底部间距

    .slider-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: flex-end; // 改为底部对齐
      justify-content: center;
    }

    .slider-track {
      display: flex;
      position: relative;
      gap: 30px;
      padding: 0 40px;
      align-items: flex-end; // 改为底部对齐
    }

    .slide {
      flex: 0 0 280px;
      transition: all 0.5s ease;
      cursor: pointer;

      &.active {
        flex: 0 0 400px;

        .content-wrapper {
          transform: scale(1);
          opacity: 1;
        }

        .specs,
        .view-more,
        .price {
          opacity: 1;
          transform: translateY(0);
          display: block;
        }
      }

      .content-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        transform: scale(0.9);
        transition: all 0.5s ease;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        min-height: 300px; // 设置最小高度
        position: relative; // 添加相对定位
      }

      .car-name {
        font-size: 1.8rem;
        margin: 0;
        text-align: center;
        font-weight: 600;
      }

      .car-image {
        width: 100%;
        height: 180px;
        overflow: hidden;
        border-radius: 12px;

        img {
          width: 100%;
          height: 100%;
          object-fit: contain;
        }
      }

      .price {
        font-size: 1.2rem;
        color: #666;
        margin: 0;
        display: none;
      }

      .specs {
        width: 100%;
        display: none;

        p {
          margin: 5px 0;
          color: #444;
        }
      }

      .view-more {
        padding: 10px 25px;
        background: #000;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        display: none;
        margin-top: auto; // 将按钮推到底部
      }
    }
  }
</style>

<script>
  import { gsap } from 'gsap'

  document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.slider-track')
    const slides = Array.from(document.querySelectorAll('.slide'))
    const nextBtn = document.querySelector('.nav-btn.next')
    const prevBtn = document.querySelector('.nav-btn.prev')

    let currentIndex = Math.floor(slides.length / 2)

    const updateContentVisibility = (slide, distance) => {
      const price = slide.querySelector('.price')
      const specs = slide.querySelector('.specs')
      const viewMore = slide.querySelector('.view-more')

      if (distance === 0) {
        // 激活状态：显示所有内容
        gsap.to([price, specs, viewMore], {
          duration: 0.5,
          opacity: 1,
          y: 0,
          display: 'block',
          ease: 'power2.out',
        })
      } else if (Math.abs(distance) === 1) {
        // 相邻状态：只显示价格
        gsap.to(price, {
          duration: 0.5,
          opacity: 0.7,
          y: 0,
          display: 'block',
          ease: 'power2.out',
        })
        gsap.to([specs, viewMore], {
          duration: 0.5,
          opacity: 0,
          y: 10,
          display: 'none',
          ease: 'power2.out',
        })
      } else {
        // 远离状态：隐藏价格、详情和按钮
        gsap.to([price, specs, viewMore], {
          duration: 0.5,
          opacity: 0,
          y: 10,
          display: 'none',
          ease: 'power2.out',
        })
      }
    }

    const updateSlides = () => {
      // 获取容器宽度
      const containerWidth =
        document.querySelector('.slider-container').offsetWidth
      const slideWidth = 400 // 激活状态的宽度
      const baseOffset = (containerWidth - slideWidth) / 2

      slides.forEach((slide, index) => {
        const distance = index - currentIndex
        const isActive = distance === 0

        // 更新slide状态
        slide.classList.toggle('active', isActive)

        // 计算位置 - 使用容器宽度来确保中心定位
        const xPosition = baseOffset + distance * 310 // 调整间距

        // 动画过渡
        gsap.to(slide, {
          duration: 0.5,
          x: xPosition,
          scale: isActive ? 1 : 0.85,
          opacity: isActive ? 1 : Math.abs(distance) === 1 ? 0.7 : 0.4,
          ease: 'power2.out',
        })

        // 更新内容显示
        const content = slide.querySelector('.content-wrapper')
        const price = slide.querySelector('.price')
        const specs = slide.querySelector('.specs')
        const viewMore = slide.querySelector('.view-more')

        if (isActive) {
          // 激活状态：显示所有内容
          gsap.to([price, specs, viewMore], {
            duration: 0.3,
            opacity: 1,
            display: 'block',
            height: 'auto',
            ease: 'power2.out',
          })
        } else if (Math.abs(distance) === 1) {
          // 相邻状态：显示价格
          gsap.to(price, {
            duration: 0.3,
            opacity: 0.7,
            display: 'block',
            height: 'auto',
            ease: 'power2.out',
          })
          gsap.to([specs, viewMore], {
            duration: 0.3,
            opacity: 0,
            display: 'none',
            height: 0,
            ease: 'power2.out',
          })
        } else {
          // 远离状态：隐藏所有额外内容
          gsap.to([price, specs, viewMore], {
            duration: 0.3,
            opacity: 0,
            display: 'none',
            height: 0,
            ease: 'power2.out',
          })
        }
      })
    }

    // 点击事件处理
    slides.forEach((slide, index) => {
      slide.addEventListener('click', () => {
        if (index !== currentIndex) {
          currentIndex = index
          updateSlides()
        }
      })
    })

    // 导航按钮事件
    nextBtn?.addEventListener('click', () => {
      if (currentIndex < slides.length - 1) {
        currentIndex++
        updateSlides()
      }
    })

    prevBtn?.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--
        updateSlides()
      }
    })

    // 窗口大小改变时重新计算位置
    window.addEventListener('resize', updateSlides)

    // 初始化
    updateSlides()
  })
</script>
